!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).knnjs=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){exports.knn=function(){const gRadius=5;var gColorMap={},gHeight=null,gWidth=null,gSelectedDataSet=null,gSelectedColumns=null,gCategoryName=null;function knn(xTarget,yTarget,dataset,k,xColName,yColName,clsName){const subset=dataset.map(function(y2){return{s:y2[clsName],x:y2[xColName],y:y2[yColName],d:(y1=yTarget,x2=y2[xColName],y2=y2[yColName],Math.sqrt(Math.pow(xTarget-x2,2)+Math.pow(y1-y2,2)))};var y1,x2}),topValues=subset.sort((a,b)=>a.d-b.d).slice(0,k);return{votes:function(chunks){var max=0;Object.keys(chunks).forEach(function(key){max=Math.max(chunks[key],max)});var count=0,res=null;return Object.keys(chunks).forEach(function(key){chunks[key]==max&&(res=key,count+=1)}),1<count?null:res}(topValues.reduce((total,curr)=>(total.hasOwnProperty(curr.s)?total[curr.s]+=1:total[curr.s]=1,total),{})),candidates:topValues}}function emptyChild(ele){for(;ele.firstChild;)ele.removeChild(ele.firstChild)}function buildKnnHtml(td){var divBtn=document.createElement("div"),divCand=document.createElement("button");divCand.addEventListener("click",function(){!function(){for(var boundary=document.querySelectorAll(".knnjs-boundary"),i=0;i<boundary.length;i++)"0"==boundary[i].style.fillOpacity||""==boundary[i].style.fillOpacity?boundary[i].style.fillOpacity="1":boundary[i].style.fillOpacity="0"}()}),divCand.innerText="Show/Hide Decision Boundary",divBtn.appendChild(divCand);var select=document.createElement("select");select.setAttribute("name","kvalue"),select.setAttribute("id","kvalue");var label=document.createElement("option");label.innerText="3",select.appendChild(label);var divDl=document.createElement("option");divDl.innerText="4",select.appendChild(divDl);divCand=document.createElement("option");divCand.innerText="5",select.appendChild(divCand),select.addEventListener("change",function(){initInternal()});label=document.createElement("label");label.setAttribute("for","kvalue"),label.innerText="Choose a value for K:";divDl=document.createElement("div"),divCand=document.createElement("dl");divCand.setAttribute("id","legend"),divCand.setAttribute("class","knnjs-dl"),divDl.appendChild(divCand);divCand=document.createElement("div");divCand.setAttribute("id","cand"),td.appendChild(label),td.appendChild(select),td.appendChild(divDl),td.appendChild(divBtn),td.appendChild(document.createElement("hr")),td.appendChild(divCand)}let publicScope={};function initInternal(){const xColName=gSelectedColumns[0],yColName=gSelectedColumns[1];d3.select("div#knn-data-vis > *").remove();var cand=document.getElementById("cand");emptyChild(cand),emptyChild(document.getElementById("legend"));var margin_top=10,yMaxVal=30,step=40,margin_left=60,width=gWidth-margin_left-yMaxVal,height=gHeight-margin_top-step,svg=d3.select("#knn-data-vis").append("svg").attr("width",width+margin_left+yMaxVal).attr("height",height+margin_top+step).append("g").attr("transform","translate("+margin_left+","+margin_top+")"),xMinVal=Math.min(...gSelectedDataSet.map(ele=>ele[xColName])),xMaxVal=Math.max(...gSelectedDataSet.map(ele=>ele[xColName])),yMinVal=Math.min(...gSelectedDataSet.map(ele=>ele[yColName])),yMaxVal=Math.max(...gSelectedDataSet.map(ele=>ele[yColName])),step=Math.max(xMaxVal-xMinVal,yMaxVal-yMinVal)/7,x=d3.scaleLinear().domain([xMinVal-step,xMaxVal+step]).range([0,width]);svg.append("g").attr("transform",`translate(0, ${height})`).call(d3.axisBottom(x)),svg.append("text").attr("transform",`translate(${width/2}, ${height+margin_top+20})`).style("text-anchor","middle").text(xColName),svg.append("text").attr("transform","rotate(-90)").attr("y",0-margin_left).attr("x",0-height/2).attr("dy","1em").style("text-anchor","middle").text(yColName);var y=d3.scaleLinear().domain([yMinVal-step,yMaxVal+step]).range([height,0]);svg.append("g").call(d3.axisLeft(y)),function(){var legend=document.getElementById("legend");Object.keys(gColorMap).forEach(function(key){var dd=document.createElement("div");dd.setAttribute("style",`float: left; width: 20px; height: 20px; vertical-align: middle; background: ${gColorMap[key]}`),legend.appendChild(dd);dd=document.createElement("div");dd.innerText=key,legend.appendChild(dd)})}(),function(svg,x,y,xMinVal,xMaxVal,yMinVal,yMaxVal,data,xColName,yColName,clsName,step){for(var w=xMinVal-step;w<xMaxVal+step;w+=step/5.5)for(var h=yMinVal-step;h<yMaxVal+step;h+=step/5.5)svg.append("g").append("circle").attr("cx",function(d){return x(w)}).attr("cy",function(d){return y(h)}).attr("r",2).attr("class","knnjs-boundary").style("fill",function(d){var res=knn(w,h,data,parseInt(document.getElementById("kvalue").value),xColName,yColName,clsName);return gColorMap.hasOwnProperty(res.votes)?gColorMap[res.votes]:"black"})}(svg,x,y,xMinVal,xMaxVal,yMinVal,yMaxVal,gSelectedDataSet,xColName,yColName,gCategoryName,step),function(svg,x,y,data,xColName,yColName,clsName){svg.append("g").selectAll("dot").data(data).enter().append("circle").attr("cx",function(d){return x(d[xColName])}).attr("cy",function(d){return y(d[yColName])}).attr("r",gRadius).style("fill",function(d){return gColorMap.hasOwnProperty(d[clsName])?gColorMap[d[clsName]]:"black"})}(svg,x,y,gSelectedDataSet,xColName,yColName,gCategoryName);const div=function(rect){const ele=document.getElementById(rect);return{left:(rect=ele.getBoundingClientRect()).left+window.scrollX,top:rect.top+window.scrollY}}("knn-data-vis");d3.select("#knn-data-vis").on("click",function(){const yDot=y.invert(d3.event.pageY-div.top-margin_top),xDot=x.invert(d3.event.pageX-div.left-margin_left);var candidates=null;svg.append("g").append("circle").attr("cx",function(d){return x(xDot)}).attr("cy",function(d){return y(yDot)}).attr("r",5).style("stroke","black").style("fill",function(d){var res=knn(xDot,yDot,gSelectedDataSet,parseInt(document.getElementById("kvalue").value),xColName,yColName,gCategoryName);return candidates=res.candidates,gColorMap.hasOwnProperty(res.votes)?gColorMap[res.votes]:"black"}),emptyChild(cand);var titleDiv=document.createElement("div");titleDiv.innerText="nearest neighbors:",cand.appendChild(titleDiv);for(var c=0;c<candidates.length;c++){var candDiv=document.createElement("div");candDiv.setAttribute("style",`background: ${gColorMap[candidates[c].s]}`),candDiv.innerText=`${candidates[c].s}, x: ${candidates[c].x}, y: ${candidates[c].y}`,cand.appendChild(candDiv),svg.append("line").attr("x1",x(xDot)).attr("x2",x(candidates[c].x)).attr("y1",y(yDot)).attr("y2",y(candidates[c].y)).attr("stroke","black").attr("stroke-width",2).transition().duration(2e3).style("opacity",0)}})}return publicScope.init=function(divViz,td2){var table,tr,td1;!function(options){return!(null==options.selectedDataSet||options.selectedDataSet.length<=0)&&(!(null==options.selectedColumns||options.selectedColumns.length<2)&&(null!=options.categoryName&&""!=options.categoryName))}(td2)||(td2=function(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}({colorMap:{},height:640,width:690,selectedDataSet:null,selectedColumns:null,categoryName:null},td2),gColorMap=td2.colorMap,gHeight=td2.height,gWidth=td2.width,gSelectedDataSet=td2.selectedDataSet,gSelectedColumns=td2.selectedColumns,gCategoryName=td2.categoryName,divViz.replaceChildren(),divViz.appendChild((table=document.createElement("table"),tr=document.createElement("tr"),td1=document.createElement("td"),td2=document.createElement("td"),(divViz=document.createElement("div")).setAttribute("id","knn-data-vis"),buildKnnHtml(td2),td1.appendChild(divViz),tr.appendChild(td1),tr.appendChild(td2),table.appendChild(tr),table)),initInternal())},publicScope}},{}]},{},[1])(1)});
